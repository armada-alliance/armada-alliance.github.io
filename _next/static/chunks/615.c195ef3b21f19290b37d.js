(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[615],{84615:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return S}});var r=n(809),a=n.n(r),o=n(92447),s=n(71385),u=n(74047),i=n(52700),c=new(function(){function e(){(0,u.Z)(this,e)}return(0,i.Z)(e,[{key:"load",value:function(){var e=(0,o.Z)(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._wasm){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,Promise.all([n.e(334),n.e(107)]).then(n.bind(n,4351));case 4:this._wasm=e.sent;case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"Cardano",get:function(){return this._wasm}}]),e}()),d={randomImprove:function(){var e=(0,o.Z)(a().mark((function e(t,n,r,o){var u,i,d;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.load();case 2:return u={selection:[],remaining:(0,s.Z)(t),subset:[],amount:c.Cardano.Value.new(c.Cardano.BigNum.from_str("0")),change:c.Cardano.Value.new(c.Cardano.BigNum.from_str("0"))},i=l(n),(d=h(d=g(i),"DESC")).forEach((function(e){C(u,e);try{u=m(x(u),e,r-u.selection.length,o)}catch(t){if("INPUT_LIMIT_EXCEEDED"!==t.message)throw t;u=f(u,e,r-u.selection.length,o)}})),d.reverse(),d.forEach((function(e){C(u,e);var t={};t.ideal=c.Cardano.Value.new(c.Cardano.BigNum.from_str("0")).checked_add(e).checked_add(e),t.maximum=c.Cardano.Value.new(c.Cardano.BigNum.from_str("0")).checked_add(t.ideal).checked_add(e),p(u,e,r-u.selection.length,t)})),e.abrupt("return",{input:u.selection,output:n,remaining:u.remaining,amount:u.amount,change:b(u.selection,i)});case 10:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}()};function m(e,t,n,r){if(v(t,e.amount,r))return e.remaining=[].concat((0,s.Z)(e.remaining),(0,s.Z)(e.subset)),e.subset=[],e;if(n<=0)throw new Error("INPUT_LIMIT_EXCEEDED");var a=e.subset.length;if(a<=0){if(v(t,e.amount,0))throw new Error("MIN_UTXO_ERROR");throw new Error("INPUTS_EXHAUSTED")}var o=e.subset.splice(Math.floor(Math.random()*a),1).pop();return e.selection.push(o),e.amount=_(o.output().amount(),e.amount),m(e,t,n-1,r)}function f(e,t,n,r){e.subset=e.subset.sort((function(e,t){return t.output().amount().compare(e.output().amount())}));do{if(n<=0)throw new Error("INPUT_LIMIT_EXCEEDED");if(e.subset.length<=0){if(v(t,e.amount,0))throw new Error("MIN_UTXO_ERROR");throw new Error("INPUTS_EXHAUSTED")}var a=e.subset.splice(0,1).pop();e.selection.push(a),e.amount=_(a.output().amount(),e.amount),n--}while(!v(t,e.amount,r));return e.remaining=[].concat((0,s.Z)(e.remaining),(0,s.Z)(e.subset)),e.subset=[],e}function p(e,t,n,r){var a=e.subset.length;if(e.amount.compare(r.ideal)>=0||a<=0||n<=0)return e.remaining=[].concat((0,s.Z)(e.remaining),(0,s.Z)(e.subset)),void(e.subset=[]);var o=e.subset.splice(Math.floor(Math.random()*a),1).pop(),u=c.Cardano.Value.new(c.Cardano.BigNum.from_str("0")).checked_add(o.output().amount()).checked_add(t);return E(w(r.ideal)-w(u))<E(w(r.ideal)-w(t))&&u.compare(r.maximum)<=0?(e.selection.push(o),e.amount=_(o.output().amount(),e.amount),n--):e.remaining.push(o),p(e,t,n,r)}function l(e){for(var t=c.Cardano.Value.new(c.Cardano.BigNum.from_str("0")),n=0;n<e.len();n++)t=_(e.get(n).amount(),t);return t}function _(e,t){return t.checked_add(e)}function g(e){var t=[];if(t.push(c.Cardano.Value.new(c.Cardano.BigNum.from_bytes(e.coin().to_bytes()))),e.multiasset())for(var n=e.multiasset(),r=0;r<n.keys().len();r++)for(var a=n.keys().get(r),o=0;o<n.get(a).keys().len();o++){var s=c.Cardano.Assets.new(),u=n.get(a).keys().get(o);s.insert(c.Cardano.AssetName.from_bytes(u.to_bytes()),c.Cardano.BigNum.from_bytes(n.get(a).get(u).to_bytes()));var i=c.Cardano.MultiAsset.new();i.insert(c.Cardano.ScriptHash.from_bytes(a.to_bytes()),s);var d=c.Cardano.Value.new(c.Cardano.BigNum.from_str("0"));d.set_multiasset(i),t.push(d)}return t}function h(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ASC";return e.sort((function(e,n){var r="DESC"===t?BigInt(-1):BigInt(1);return Number((w(e)-w(n))*r)}))}function w(e){var t=BigInt(0),n=BigInt(e.coin().to_str());if(n>0)t=n;else if(e.multiasset()&&e.multiasset().len()>0){var r=e.multiasset().keys().get(0),a=e.multiasset().get(r).keys().get(0);t=BigInt(e.multiasset().get(r).get(a).to_str())}return t}function C(e,t){BigInt(t.coin().to_str())<BigInt(1)?e.remaining.forEach((function(n,r){void 0!==t.compare(n.output().amount())&&e.subset.push(e.remaining.splice(r,1).pop())})):e.subset=e.remaining.splice(0,e.remaining.length)}function b(e,t){var n=e.map((function(e){return e.output().amount()})),r=c.Cardano.Value.new(c.Cardano.BigNum.from_str("0"));return n.forEach((function(e){return r=r.checked_add(e)})),r.checked_sub(t)}function v(e,t,n){var r=e;if(BigInt(r.coin().to_str())>0){var a=c.Cardano.Value.new(c.Cardano.min_ada_required(t,c.Cardano.BigNum.from_str(n.toString())));r=(r=c.Cardano.Value.new(c.Cardano.BigNum.from_bytes(r.coin().to_bytes()))).checked_add(a)}return t.compare(r)>=0}function x(e){return{selection:y(e.selection),remaining:y(e.remaining),subset:y(e.subset),amount:k(e.amount),change:k(e.change)}}var y=function(e){return e.map((function(e){return c.Cardano.TransactionUnspentOutput.from_bytes(e.to_bytes())}))},k=function(e){return c.Cardano.Value.from_bytes(e.to_bytes())};function E(e){return e<0?e*BigInt(-1):e}var B=d,N=n(48764).Buffer,T=function(){var e=(0,o.Z)(a().mark((function e(t,n,r){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://cardano-mainnet.blockfrost.io/api/v0"+t,{headers:{project_id:"3Ojodngr06BReeSN9lhsow0hypKf8gu5"}}).then((function(e){return e.json()}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),I=function(){var e=(0,o.Z)(a().mark((function e(){var t,n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.load();case 2:return e.next=4,T("/blocks/latest");case 4:return t=e.sent,e.next=7,T("/epochs/".concat(t.epoch,"/parameters"));case 7:return n=e.sent,e.abrupt("return",{linearFee:c.Cardano.LinearFee.new(c.Cardano.BigNum.from_str(n.min_fee_a.toString()),c.Cardano.BigNum.from_str(n.min_fee_b.toString())),minUtxo:c.Cardano.BigNum.from_str(n.min_utxo),poolDeposit:c.Cardano.BigNum.from_str(n.pool_deposit),keyDeposit:c.Cardano.BigNum.from_str(n.key_deposit),maxTxSize:c.Cardano.max_tx_size});case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),S={delegationTx:function(){var e=(0,o.Z)(a().mark((function e(t,n){var r,o,s,u,i,d,m,f,p,l,_,g,h,w,C,b,v,x,y,k,E;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.load();case 2:return e.next=4,I();case 4:return r=e.sent,e.next=7,window.cardano.getUsedAddresses();case 7:return o=e.sent[0],o=c.Cardano.Address.from_bytes(N.from(o,"hex")),e.next=11,window.cardano.getRewardAddress();case 11:return s=e.sent,u=c.Cardano.RewardAddress.from_address(c.Cardano.Address.from_bytes(N.from(s,"hex"))).payment_cred(),e.next=15,window.cardano.getUtxos();case 15:return i=(i=e.sent).map((function(e){return c.Cardano.TransactionUnspentOutput.from_bytes(N.from(e,"hex"))})),d=5848,m=5860,(f=c.Cardano.TransactionOutputs.new()).add(c.Cardano.TransactionOutput.new(o,c.Cardano.Value.new(r.keyDeposit))),e.next=23,B.randomImprove(i,f,20,r.minUtxo.to_str());case 23:for(p=e.sent,l=p.input,_=c.Cardano.TransactionBuilder.new(r.linearFee,r.minUtxo,r.poolDeposit,r.keyDeposit),g=0;g<l.length;g++)h=l[g],_.add_input(h.output().address(),h.input(),h.output().amount());if(w=c.Cardano.Certificates.new(),t.active||w.add(c.Cardano.Certificate.new_stake_registration(c.Cardano.StakeRegistration.new(u))),w.add(c.Cardano.Certificate.new_stake_delegation(c.Cardano.StakeDelegation.new(u,c.Cardano.Ed25519KeyHash.from_bech32(n)))),_.set_certs(w),C=p.change,(b=C.multiasset())&&2*C.to_bytes().length>m&&(v=c.Cardano.Value.new(c.Cardano.BigNum.from_str("0")),x=c.Cardano.MultiAsset.new(),y=b.keys(),function(){for(var e=0;e<b.len();e++){for(var t=y.get(e),n=b.get(t),r=n.keys(),a=c.Cardano.Assets.new(),o=0;o<r.len();o++){var s=r.get(o),u=n.get(s);a.insert(s,u);var i=c.Cardano.MultiAsset.from_bytes(x.to_bytes());if(i.insert(t,a),2*i.to_bytes().length>=d)return void x.insert(t,a)}x.insert(t,a)}}(),v.set_multiasset(x),k=c.Cardano.min_ada_required(v,r.minUtxo),v.set_coin(k),_.add_output(c.Cardano.TransactionOutput.new(o,v))),_.add_change_if_needed(o),E=c.Cardano.Transaction.new(_.build(),c.Cardano.TransactionWitnessSet.new()),!(2*E.to_bytes().length>r.maxTxSize)){e.next=39;break}throw ERROR.txTooBig;case 39:return e.abrupt("return",E);case 40:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),signTx:function(){var e=(0,o.Z)(a().mark((function e(t){var n,r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.load();case 2:return e.next=4,window.cardano.signTx(N.from(t.to_bytes(),"hex").toString("hex"));case 4:return n=e.sent,e.next=7,c.Cardano.Transaction.new(t.body(),c.Cardano.TransactionWitnessSet.from_bytes(N.from(n,"hex")));case 7:return r=e.sent,e.abrupt("return",r);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),submitTx:function(){var e=(0,o.Z)(a().mark((function e(t){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.cardano.submitTx(N.from(t.to_bytes(),"hex").toString("hex"));case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getDelegation:function(){var e=(0,o.Z)(a().mark((function e(){var t,n,r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.load();case 2:return e.next=4,window.cardano.getRewardAddress();case 4:return t=e.sent,n=c.Cardano.Address.from_bytes(N.from(t,"hex")).to_bech32(),e.next=8,T("/accounts/".concat(n));case 8:if((r=e.sent)&&!r.error&&r.pool_id){e.next=11;break}return e.abrupt("return",{});case 11:return e.abrupt("return",r);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),blockfrostRequest:T}}}]);